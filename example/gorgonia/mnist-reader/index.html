<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Gorgonia run on cloud run</title>

  <!-- fabric.js library -->
  <!--
  <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js'></script>
  -->
  <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/dark.css'>
  <script type='text/javascript' src='static/js/fabric.min.js'></script>

  <!-- Going to use JQuery so its good to have library locally -->
  <script type='text/javascript' src="static/js/jquery-3.2.1.min.js"></script>
        <script type='text/javascript'>

            
            var canvas;
            var image;
            var bThick = 20;
            var cColour = '#FFFFFF'; // #black

            //Initialize  fabric 
            function initCanvas(){
                canvas = new fabric.Canvas('canvasBox');
		canvas.allowTouchScrolling = false;
                canvas.isDrawingMode = true;
                canvas.freeDrawingBrush.width = bThick;
                canvas.freeDrawingBrush.color = cColour;
                canvas.backgroundColor = '#000000';            
            }
        
            window.onload = function(){
                initCanvas();
                // submit button
                var btnsub = document.getElementById('btnSubmit');
                btnsub.addEventListener('click', postImg());
            };
            
            //reset canvas
            function reset() {           
                canvas.clear();   
                $('#guess').text('');     
            }

            function postImg(){                        
                var imgURL = canvas.toDataURL();   

                //Send Ajax call
                $.ajax({
                    type: 'post',
                    url: 'https://mnist-7qfm5j5rza-uc.a.run.app/picture',
                    data: imgURL,
                
                    success: function(data){
                        $('#guess').text(data);
                    }              
                });                     
            }
        </script>


</head>
    <body>
	    <h1>Demo of onnx-go running on cloud run</h1>
	    <p>This an example app of onnx-go backed by cloud run. Draw a number and the app will guess.</p>
      <canvas id="canvasBox"position="relative" width="280" height="280"></canvas>                             
      <button id="btnSubmit" onclick="postImg()">Submit</button>
      <button onclick="reset()">Reset</button>
      <h2>Result:</h2>
      <h1 id="guess"></h1>
      Build with <a href="https://github.com/owulveryck/onnx-go">onnx-go</a>
    </body>
</html>
